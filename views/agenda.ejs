<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bel√©n Escobar | Agenda</title>

    <!-- Bootstrap 4 local -->
    <link rel="stylesheet" href="/css/bootstrap.min.css" />

    <!-- Tipograf√≠a elegante -->

    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="/styles.css" />
    <style>
      body {
        margin-top: 80px; /* Espacio desde el top */
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
      <div class="container">
        <a class="navbar-brand fw-bold text-dark" href="/">Bel√©n Escobar</a>
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#menu"
          aria-controls="menu"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon">:D</span>
        </button>
        <div class="collapse navbar-collapse" id="menu">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="/catalogo/nina">Ni√±a</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/catalogo/gala">Gala</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/catalogo/15">15 a√±os</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/catalogo/autoc">Aut√≥ctonos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/catalogo/agenda">AGENDAR CITA</a>
            </li>
            <% if (usuario) { %>
            <li class="nav-item">
              <form action="/logout" method="POST" class="form-inline">
                <button
                  type="submit"
                  class="btn btn-sm btn-outline-danger ml-2"
                >
                  Salir
                </button>
              </form>
            </li>
            <% } else { %>
            <li class="nav-item">
              <a class="nav-link" href="/login">Login</a>
            </li>
            <% } %>
          </ul>
        </div>
      </div>
    </nav>

    <div>
      <% if (!usuario) { %>
      <div class="card tarjeta-visitante mx-auto mt-5">
        <div class="card-body text-center">
          <h2 class="card-title">Bienvenido visitante üëã</h2>
          <p class="card-text texto-descriptivo">
            Para agendar una cita, por favor
            <a href="/login" class="btn btn-sm btn-outline-primary"
              >inici√° sesi√≥n</a
            >.
          </p>
        </div>
      </div>
      <% } %>
    </div>
    <% if (usuario && usuario.email !== "rommel@gmail.com") { %>
    <!-- Hero -->
    <section class="hero text-center py-4 bg-light">
      <div class="container">
        <h1>Agenda tu cita</h1>
        <p>Coordin√° tu visita para elegir el vestido perfecto</p>
      </div>
    </section>

    <!-- Formulario de cita -->
    <section class="container d-flex justify-content-center py-4">
      <div class="card shadow-sm p-4" style="max-width: 600px; width: 100%">
        <h4
          class="text-center mb-4"
          style="font-family: 'Playfair Display', serif"
        >
          Agendar cita
        </h4>
        <!-- error de registro-->
        <% if (error) { %>
        <div class="alert alert-danger text-center" role="alert">
          <%= error %>
        </div>
        <% } %>
        <!--  -->
        <!-- registro exitoso-->
        <% if (typeof confirmacion !== 'undefined' && confirmacion === 'ok') {
        %>
        <div class="alert alert-success text-center" role="alert">
          ‚úÖ Cita agendada correctamente.
        </div>
        <% } %>
        <!--  -->
        <form action="/catalogo/agenda" method="POST">
          <div class="form-group">
            <label>Nombre</label>
            <input
              type="text"
              name="nombre"
              class="form-control form-control-sm"
              value="<%= usuario.nombre %>"
              required
            />
          </div>
          <div class="form-group">
            <label>Tel√©fono</label>
            <input
              type="text"
              name="telefono"
              class="form-control form-control-sm"
              value="<%= usuario.celular %>"
              required
            />
          </div>
          <div class="form-row">
            <div class="form-group col-md-6">
              <label>Fecha</label>
              <input
                type="date"
                name="fecha"
                class="form-control form-control-sm"
                required
              />
            </div>
            <div class="form-group col-md-6">
              <label>Hora</label>
              <select name="hora" class="form-control form-control-sm">
                <option value="10:30">En la ma√±ana (10:30 am)</option>
                <option value="15:00">En la tarde(15:00 pm)</option>
                <option value="16:00">En la tarde(16:00 pm)</option>
                <option value="17:00">En la tarde(17:00 pm)</option>
                <option value="18:00">En la tarde(18:00 pm)</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label>Servicio</label>
            <select name="servicio" class="form-control form-control-sm">
              <option value="Vestido para ni√±a">Vestido para ni√±a</option>
              <option value="Vestido para 15 a√±os">Vestido de 15 a√±os</option>
              <option value="Vestido para gala">Vestido de gala</option>
              <option value="Vestido para Aut√≥ctonos">Vestido aut√≥ctono</option>
            </select>
          </div>
          <div class="form-group">
            <label>Mensaje adicional</label>
            <textarea
              class="form-control form-control-sm"
              name="mensaje"
              rows="2"
            ></textarea>
          </div>
          <div class="text-center">
            <button type="submit" class="btn btn-dark btn-sm px-4">
              Agendar
            </button>
          </div>
        </form>
      </div>
    </section>
    <% } %>

    <!-- Tabla de citas -->
    <% if (usuario && usuario.email === "rommel@gmail.com") { %>

    <section class="container py-4">
      <h2
        class="mb-4 text-center"
        style="font-family: 'Playfair Display', serif"
      >
        Citas agendadas
      </h2>

      <div class="table-responsive shadow-sm rounded">
        <table class="table table-striped table-bordered">
          <thead class="thead-dark">
            <tr class="text-center">
              <th>üë§ Nombre</th>
              <th>üìÖ Fecha</th>
              <th>‚è∞ Hora</th>
              <th>üéØ Servicio</th>
              <th>üìå Estado</th>
              <th>üìù Mensaje</th>
            </tr>
          </thead>
          <tbody>
            <% if (citas && citas.length > 0) { %> <% citas.forEach(c => { %>
            <tr>
              <td class="align-middle"><%= c.nombre %></td>
              <td class="align-middle">
                <% const meses = [ "enero", "febrero", "marzo", "abril", "mayo",
                "junio", "julio", "agosto", "septiembre", "octubre",
                "noviembre", "diciembre" ]; const partes = c.fecha.split("-");
                const dia = parseInt(partes[2]); const mes =
                meses[parseInt(partes[1]) - 1]; %> <%= `${dia} de ${mes}` %>
              </td>
              <td class="align-middle"><%= c.hora %></td>
              <td class="align-middle">
                <span class="badge badge-info"><%= c.servicio %></span>
              </td>
              <td class="align-middle">
                <span
                  class="badge <%= c.estado === 'Confirmada' ? 'badge-success' : c.estado === 'Cancelada' ? 'badge-danger' : 'badge-warning' %>"
                >
                  <%= c.estado || "Pendiente" %>
                </span>
              </td>
              <td class="align-middle"><%= c.mensaje %></td>
            </tr>
            <% }) %> <% } else { %>
            <tr>
              <td colspan="6" class="text-center text-muted">
                No hay citas registradas.
              </td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </section>

    <% } %>

    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
  </body>
</html>
